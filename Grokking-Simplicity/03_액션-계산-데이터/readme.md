# 3. 액션과 계산, 데이터의 차이를 알기

#### 이번 장에서 살펴볼 내용

- 액션과 계산, 데이터가 어떻게 다른지 배웁니다
- 문제에 대해 생각하거나 코드를 작성할 때 또는 코드를 읽을 때 액션과 계산, 데이터를 구분해서 적용해봅니다
- `액션이 코드 전체로 퍼질 수 있다`는 것을 이해합니다
- 이미 있는 코드에서 어떤 부분이 액션인지 찾아봅니다

## 액션과 계산, 데이터

- 액션 : 실행 시점과 횟수에 의존합니다
- 계산 : 입력으로 출력을 계산합니다
  - 순수 함수
- 데이터 이벤트에 대한 사실

## 액션과 계산, 데이터는 어디에나 적용할 수 있습니다

### 장보기에 액션과 계산, 데이터를 적용해봅시다

#### 함수형이 아닌 장보기 과정

- 냉장고 확인하기(액션)
  - 냉장고를 확인하는 시점에 따라 냉장고에 있는 제품이 다르기 때문
- 운전해서 상점으로 가기(액션)
  - 두 번 운전해서 상점에 가면 연료가 두 배로 듭니다
- 필요한 것 구입하기(액션)
  - 시점에 따라 브로콜리를 사러갔는데 매진돼서 브로콜리가 없을 수 있습니다
- 운전해서 집으로 오기(액션)
  - 이미 집에 있다면 상점에 있는 것이 아니기 때문에 상점에서 집으로 올 수 없습니다

### 냉장고 확인하기

- 냉장고에 가지고 있는 제품은 데이터 입니다
- 이것을 현재 재고라고 합시다

### 운전해서 상점으로 가기

- 상점위치나 가는 경로는 데이터로 볼 수 있지만 자율 주행 자동자를 만드는 것이 아니기 때문에 따로 분리하지 않겠습니다

### 필요한 것 구입하기

- 구입 과정은 몇 단계로 나눌 수 있습니다
  - 데이터 : 현재 재고
  - 데이터 : 필요한 재고
  - 계산 : 재고 '빼기'
  - 데이터 : 장보기 목록
  - 액션 : 목록에 있는 것 구입하기

### 운전해서 집으로 오기

- 운전해서 집으로 오는 단계도 나눌 수 있지만 우리가 다루려고 하는 범위가 아니기 때문에 나누지 않겠습니다

### 장보기 과정 정리

| 액션                    | 계산        | 데이터      |
| :---------------------- | :---------- | :---------- |
| 냉장고 확인             | -           | 현재 재고   |
| 운전해서 상점으로 가기  | -           | -           |
| -                       | 재고 '빼기' | 필요한 재고 |
| -                       | -           | 장보기 목록 |
| 목록에 있는 것 구입하기 | -           | -           |
| 운전해서 집으로 오기    | -           | -           |

## 장보기 과정에서 배운 것

#### 1. 액션과 계산, 데이터는 어디에나 적용할 수 있습니다

- 처음에는 액션과 계산, 데이터를 적용하기 어려울 수 있지만 연습을 할 수록 더 잘할 수 있습니다

#### 2. 액션 안에는 계산과 데이터, 또 다른 액션이 숨어 있을지도 모릅니다

- 단순해 보이는 액션도 또 다른 액션이나 계산, 데이터로 나눌 수 있습니다
- 함수형 프로그래밍에서는 액션을 더 작은 액션과 계산, 데이터로 나누고 나누는 것을 언제 멈춰야 할지 아는 것이 중요합니다

#### 3. 계산은 더 작은 계산과 데이터로 나누고 연결할 수 있습니다

- 장보기 과정에서는 이러한 예를 확인할 수 없었습니다
- 하지만 '필요한 것 구입하기' 단계에서 계산에 필요한 데이터를 찾았습니다
- 계산을 더 작은 계산으로 나눌 수 있는 상황도 있습니다
- 그리고 어떤 경우는 계산을 더 작은 계산으로 나누느 것이 더 좋을 때도 있습니다
- 계산을 나누면 첫 번째 계산의 결과 데이터터가 두 번째 계산의 입력이 됩니다

#### 4. 데이터는 데이터만 조합할 수 있습니다

- 데이터는 다른 영향을 주지 않는 그냥 데이터 입니다
- 그래서 데이터 찾는 일을 먼저 해야 합니다
- 데이터를 찾았다면 동작에 대해 많은 것을 알 수 있습니다

#### 5. 계산은 때로 '우리 머리속에서' 일어납니다

- 사실 계산 단계가 있지만 잘 보이지 않는 이유는 계산이 우리 사고 과정에 녹아있기 때문입니다
- 장을 보는 상황에서 무엇을 사야 할지는 그냥 머리속에서 저절로 생각납니다
- 현실에서 장을 보다가 갑자기 무엇을 사야 할지 앉아서 목록을 작성하지는 않습니다
- 이 처럼 계산은 머리속에서 나도 모르게 일어납니다
- 하지만 이 사실을 알면 계산을 더 쉽게 찾을 수 있습니다
- 어떤 단계에서 무엇인가 결정해야 할 것이 있는지 또는 무엇인가 계획해서 방법을 찾아야 할 것이 있는지 스스로에게 물어보면 됩니다
- 결정과 계획은 계산이 될 가능성이 높기 때문입니다
- 앞에서 현실 세계에 있을 법한 장보기 예제에 액션과 계산, 데이터를 잘 적용해봤습니다
- 하지만 실제 코드에 적용하지 않았기 때문에 코드에는 어떻게 적용해야 할지 아직 모릅니다
- 이제 실제 코드에 액션과 계산, 데이터를 적용해봅시다
- 하지만 더 진행하기 전에 데이터에 대해 정리해 봅시다

## 데이터에 대해 자세히 알아보기

- 불변성

  - 함수형 프로그래머는 불변 데이터 구조를 만들기 위해 두 가지 원칙을 사용합니다(6장, 7장)
    - copy on write : 변경할 때 복사본을 만듭니다
    - defensive copy : 보관하려고 하는 데이터의 복사본을 만듭니다

- 데이터의 장점
  - 직렬화
  - 동일성 비교
  - 자유로운 해석
- 데이터의 단점
  - 해석이 반드시 필요하다
  - 계산은 해석하지 않아도 실행할 수 있습니다
  - 하지만 해석하지 않은 데이터는 쓸모없는 바이트일 뿐입니다

## 새로 만드는 코드에 함수형 사고 적용하기 - 쿠폰독 예제

- 이메일 보내기 : 액션
- 데이터베이스에서 구독자 가져오기 : 액션
- 쿠폰에 등급 매기기 : 데이터
- 데이터베이스에서 쿠폰 읽기 : 액션
- 이메일 제목 : 데이터
- 이메일 주소 : 데이터
- 추천 수 : 데이터
- 어떤 이메일이 쿠폰을 받을지 결정하기 : 계산
- 구독자 DB 레코드 : 데이터
- 쿠폰 DB 레코드 : 데이터
- 쿠폰 목록 DB 레코드 : 데이터
- 구독자 목록 DB 레코드 : 데이터
- 이메일 본문 : 데이터

## 쿠폰 보내는 과정을 그려보기

- 액션을 액션, 계산, 데이터로 나눌 수 있는 것은 나눈다
- 충분히 구현하기 쉽다고 생각되는 시점에서 더 나누는 것을 멈춘다

## 쿠폰 보내는 과정 구현하기

### 쿠폰 등급을 결정하는 함수(계산)

```js
function subCouponRank(subscriber) {
  if (subscriber.re_count >= 10) {
    return "best";
  } else {
    return "good";
  }
}
```

### 특정 등급의 쿠폰 목록을 선택하는 계산

```js
function selectCouponsByRank(coupons, rank) {
  return coupons.filter((coupon) => coupon.rank === rank);
}
```

### 구독자가 받을 이메일을 계획하는 계산

```js
function emailForSubscriber(subscriber, goods, bests) {
  const rank = subCouponRank(subscriber);
  if (rank === "best") {
    return {
      from: "newsletter@coupondog.co",
      to: "subscriber.email",
      subject: "Your best weekly coupons inside",
      body: "Here are your best coupons: " + bests.join(", "),
    };
  } else {
    return {
      from: "newsletter@coupondog.co",
      to: "subscriber.email",
      subject: "Your best weekly coupons inside",
      body: "Here are your best coupons: " + goods.join(", "),
    };
  }
}
```

### 이메일 보내기(액션)

```js
function sendIssue() {
  const coupons = fetchCouponsFromDB();
  const goodCoupons = selectCouponsByRank(coupons, "good");
  const bestCoupons = selectCouponsByRank(coupons, "best");
  const subscribers = fetchSubscribersFromDB();
  subscribers.forEach((subscriber) => {
    const email = emailForSubscriber(subscriber, goodCoupons, bestCoupons);
    sendEmail(email);
  });
}
```

- 액션은 모든 기능을 하나로 묶습니다
- 일반적인 구현 순서
  - 1. 데이터
  - 2. 계산
  - 3. 액션

## 계산에 대해 자세히 알아보기

- 액션보다 계산이 좋은 이유
  - 테스트 하기 쉽다
  - 기계적인 분석이 쉽다
  - 조합하기 좋다
    - 계산을 조합해서 일급 계산을 사용할 수 있다(14장)
- 계산 == 순수 함수, 수학함수

## 이미 있는 코드에 함수형 사고 적용하기

- 액션은 코드 전체로 퍼져나간다

## 액션은 코드 전체로 퍼집니다

## 액션은 다양한 형태로 나타납니다

- 함수형 프로그래머는 액션을 관리하는 법을 배웁니다
- 액션을 관리하기 위해서 액션이 코드에서 어떤 형태로 나타나는지 알아야 합니다

### 자바스크립트에서 발생할 수 있는 액션들

#### 함수 호출

- alert("Hello")

#### 메서드 호출

- console.log('Hello')

#### 생성자

new Date();

#### 표현식

- 변수 참조
  - y
- 속성 참조
  - user.firstName
- 배열 참조
  - stack[0]

#### 상태

- 값 할당
  - z = 3;
- 속성 삭제
  - delete user.firstName

## 액션에 대해 자세히 알아보기

#### 액션은 무엇입니까?

액션은 외부 세계에 영향을 주거나 받는 것을 말합니다

그리고 액션은 실행 시점과 횟수에 의존합니다

- 언제 실행되는지 - 순서
- 얼마나 실행되는지 - 반복

#### 액션은 어떻게 구현하나요?

- 자바스크립트에서는 함수로 구현합니다
- 계산도 함수로 구현하기 때문에 구분하기 쉽지 않습니다
- 앞으로 계산과 액션을 구분하는 방법을 알아볼 것입니다

#### 어떻게 액션에 의미를 담을 수 있나요?

- 액션으로 외부 세상에 영향을 줄 수 있습니다
  - 따라서 어떤 일을 하려는지 아는 것이 중요합니다

#### 액션의 예

- 이메일 보내기
- 계좌에서 인출하기
- 전역 변수값 바꾸기
- ajax 요청 보내기

#### 액션은 일반적으로 무엇이라고 하나요?

- 다른 책에서 액션은 아래와 같이 불립니다
  - 순수하지 않은 함수(impure function)
  - 부수 효과 함수(side-effect function)
  - 부수 효과가 있는 함수(function with side-effects)
- 이 책에서는 자바스크립 함수처럼 언어 기능과 혼동을 피하기 위해 액션이라고 부르고 있습니다

_액션은 함수형 프로그래밍에서 가장 중요합니다. 앞으로 몇 장에 걸쳐 액션을 제한적으로 사용하는 법에 대해 다루겠습니다_

#### 액션은 쉽지 않습니다

- 액션은 다루기 힘듭니다
- 액션은 우리가 소프트웨어를 실행하려는 가장 중요한 이유입니다

액션은 사용하기 어렵습니다

하지만 액션은 꼭 써야 합니다

함수형 프로그래머는 액션을 잘 사용해야 합니다

### 다음은 액션을 잘 사용하기 위한 방법입니다

#### 1. 가능한 액션을 적게 사용합니다.

- 액션을 전혀 쓰지 않을 순 없습니다
- 액션 대신 계산을 사용할 수 있는지 생각해 봐야 합니다
- 15장에서 이 내용을 다루겠습니다

#### 2. 액션은 가능한 작게 만듭니다

- 액션에서 액션과 관련 없는 코드는 모두 제거합니다
- 예를 들어, 액션에서 결정이나 계획과 관련된 부분은 계산으로 빼낼 수 있습니다
- 이 내용은 다음 장에서 자세히 알아보겠습니다

#### 3. 액션이 외부 세계와 상호작용하는 것을 제한할 수 있습니다

- 액션은 외부 세계에 영향을 주거나 받을 수 있습니다
- 내부에 계산과 데이터만 있고 가장 바깥쪽에 액션이 있는 구조가 이상적입니다
- 관련된 내용느 18장에서 어니언 아키텍처(onion architecture)를 다룰 때 살펴보겠습니다

#### 4. 액션이 호출 시점에 의존하는 것을 제한합니다

- 함수형 프로그래머는 액션이 호출 시점과 횟수에 덜 의존하도록 만드는 기술을 알고 있습니다
- 그래서 액션을 사용할 때 조금 더 쉽게 사용할 수 있습니다

## 결론

- 이 장에서 액션과 계산, 데이터를 여러 가지 상황에 적용해 봤습니다
- 계산은 계획이나 결정을 할 때 적용했고 데이터는 계획하거나 결정한 결과였습니다
- 마지막으로 액션을 통해 계산으로 만든 계획을 실행할 수 있었습니다

## 요점 정리

- 함수형 프로그래머는 액션과 계산, 데이터를 구분합니다
  - 함수형 프로그래머가 하는 것처럼 액션과 계산, 데이터를 구분하는 첫 번째 기술을 배웠습니다
- 액션은 실행 시점이나 횟수에 의존합니다
  - 일반적으로 액션은 외부 세계에 영향을 주거나 받습니다
- 계산은 입력값으로 출력값을 만드는 것입니다
  - 외부 세계에 영향을 주거나 받지 않고 실행 시점이나 횟수에 의존하지 않습니다
- 데이터는 이벤트에 대한 사실입니다
  - 사실은 변하지 않기 때문에 영구적으로 기록할 수 있습니다
- 함수형 프로그래머는 액션보다 계산을 좋아하고 계산보다 데이터를 좋아합니다
- 계산은 같은 입력값을 주면 항상 같은 출력값이 나오기 때문에 액션보다 테스트하기 쉽습니다

## 내 생각

- React에서 데이터, 계산, 액션을 이미 구분해서 사용하고 있었다
  - 데이터 : constants/
  - 계산 : utils/
  - 액션 : components/

## 다음 장에서 배울 내용

- 코드에서 액션과 계산, 데이터가 무엇인지 배웠습니다
- 하지만 충분하지 않습니다
- 함수형 프로그래머는 계산의 장점을 최대한 활용하기 위해 가능한 액션을 계산으로 바꾸려고 합니다
- 다음장에서 이 부분에 대해 살펴봅시다
