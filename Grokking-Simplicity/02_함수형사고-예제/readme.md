# 2. 현실에서의 함수형 사고

#### 이번 장에서 살펴볼 내용

- 현실적인 문제에 `함수형 사고`를 적용해 봅니다
- 소프트웨어 구조를 잡는 데 `계층형 설계`가 좋은 이유를 설명합니다
- 액션을 `타임라인`으로 시각화해 봅니다
- 타임라인을 사용하면 시간에 관한 문제를 잘 풀 수 있다는 것을 배웁니다

## 토니 피자에 오신 것을 환영합니다

- 두 가지 함수형 사고의 기술을 살펴봅시다

### 파트 1 : 액션과 계산, 데이터

- 요리 재료와 기타 자원을 사용하는 코드 : 액션
- 나머지 코드 : 계산, 데이터
- 액션과 계산, 데이터 각 분류에 해당하는 예를 살펴보고 코드에 적용한 계층형 설계 원칙이 어떤 것인지 알아봅시다

### 파트 2 : 일급 추상

- 많은 로봇 ~= 분산 시스템
- 가끔 실패하는 분산 시스템을 이해하려고 타임라인 다이어그램을 사용했습니다
- 타임 라인 다이어 그램에 대해 살펴보겠습니다
- 여러 로봇이 협력할 수 있도록 함수를 인자로 받는 일급 함수(first-class function)를 사용했습니다
  - 어떻게 더 많이 더 빨리 피자를 만들 수 있는지 알아봅시다

## 파트 1: 액션과 계산, 데이터

- 사업 성장 -> 확장성 문제
  - 함수형 사고를 적용 -> 어려움 극복
- 함수형 사고 중 가장 먼저 액션과 계산 데이터를 구분하는 것 부터 시작
  - 쉽게 다룰 수 있는 부분과 조심히 다뤄야 할 부분을 명확하게 하기 위함

### 1. 액션

- 액션 : 호출 횟수와 시점에 의존 하는 것
  - 액션은 사용할 때 조심해야 합니다
- e.g.
  - 오븐이나 배달 차 같은 자원과 요리 재료를 사용하는 것은 액셥입니다
  - 반죽 펴기
  - 피자 배달
  - 재료 주문

### 2. 계산

- 계산 : 어떤 것을 결정하거나 계획하는 것은 계산입니다
  - 계산은 실행해도 다른 곳에 영향을 주지 않습니다
- e.g.
  - 조리법에 나온 것을 두 배로 만들기
  - 쇼핑 목록 결정

### 3. 데이터

- 변경 불가능한(immutable) 데이터를 가능한 한 많이 쓰려고 합니다
- 데이터는 유연하기 때문에 저장하거나 네트워크로 전송하는 등 다양하게 쓸 수 있습니다
- e.g.
  - 결제, 재고, 피자 조리법
  - 고객 주문
  - 영수증
  - 조리법

## 변경 가능성에 따라 코드 나누기

### 계층화 설계 맛보기

- 변경할 때 드는 비용을 줄이기 위해 함수형 사고로 코드를 구성하면 좋습니다
- 먼저 변경 가능성에 따라 코드를 나눠 봅시다
  - 자주 바뀌는 코드, 덜 자주 바뀌는 코드, ... , 덜 자주 바뀌지 않는 코드, 자주 바뀌지 않는 코드

|                                                 |             피자 주방 레이어             |           창고 레이어            |  메인 레이어  |
| :---------------------------------------------: | :--------------------------------------: | :------------------------------: | :-----------: |
| 자주 바뀌는 것(이번 주 특별 메뉴를 위한 조리법) | 이번주 메뉴(재료를 어디서 구입할지 결정) |         이번주 사야할 것         | 비즈니스 규칙 |
|                                                 |         피자 만들기(조리법 순서)         | 재료 목록(재료 목록에 대한 동작) |  도메인 규칙  |
|         자주 바뀌지 않는 것(객체, 배열)         |         자바스크립트(객체, 숫자)         |          자바 스크립트           |   기술 스택   |

- 각 계층은 그 아래에 있는 계층을 기반으로 만들어 집니다
- 각 계층에 있는 코드는 더 안정적인 기반 위에 작성할 수 있습니다
- 이런 구조로 만들면 코드를 쉽게 변경할 수 있습니다
- 가장 위에 있는 코드는 의존성이 거의 없기 때문에 쉽게 바꿀 수 있습니다
- 아래에 있는 코드들은 위에 있는 코드보다 의존성이 많아 바꾸기 어렵지만 자주 바뀌지 않습니다

- 계층형 설계(-> 8장, 9장에서 자세히 다룸)
  - 비즈니스 규칙
  - 도메인 규칙
  - 기술 스택 계층

## 파트 2: 일급 추상

- 아래 타임 라인 다이어 그램은 로봇 한 대가 피자를 만들기 위한 액션을 보여줍니다
  - 피자를 만들려면 꼭 이 순서대로 해야 합니다
- 액션 다이어 그램 그리는 법 -> 15장
- 치즈 피자 만들기 타임라인 다이어그램

  - 주문 접수
  - 반죽 만들기
  - 반죽 펴기
  - 소스 만들기
  - 소스 뿌리기
  - 치즈 갈기
  - 치즈 뿌리기
  - 오븐에 넣기
  - 10분 기다리기
  - 서빙(완성)

- 액션은 실행 시점에 의존하기 때문에 실행 순서가 중요하다

## 분산 시스템을 타임라인으로 시각화하기

- 피자로봇 하나가 하던 일을 세 대가 하도록 분산
- 실행 순서가 섞일 수 있다 -> 실패

## 각각의 타임라인은 다른 순서로 실행됩니다

- 타임라인을 서로 맞추지 않은 분산 시스템은 예측 불가능한 순서로 실행됩니다

## 어려운 경험을 통해 분산 시스템에 대해 배운 것

### 회고

- 분산 시스템으로 바꾸는 것은 어렵다
- 올바른 순서로 동작하는 프로그램을 만들려면 액션(시간에 의존적인)에 집중할 필요가 있다

### 1. 타임 라인은 서로 실행 순서를 맞춰야 합니다

### 2. 액션이 실행되는 시간은 중요하지 않습니다

- 각각의 타임라인은 다른 타임라인 순서와 관계없이 만들어야 합니다

### 3. 드물지만 타이밍이 어긋나는 경우는 실제 일어납니다

- 타임라인은 항상 올바른 결과를 보장해야 합니다

### 4. 타임라인 다이어그램으로 시스템의 문제를 알 수 있습니다

## 타임라인 커팅: 로봇이 서로를 기다릴 수 있게 하기

- 타임라인 커팅 : 여러 타임라인이 동시에 진행될 때 서로 순서를 맞추는 방법
  - 고차 동작(high-order operation)으로 구현합니다
- 각 타임라인은 독립적으로 동작하고 작업이 완료되면 다른 타임라인 끝나기를 기다리기 때문에 어떤 타임라인이 먼저 끝나도 괜찮습니다

- 서로 순서를 맞춘 로봇들(타임라인 커팅 적용)
  - 반죽만들기, 치즈갈기, 소스 만들기
  - (타임라인 커팅)
  - 반죽 펴기
  - 소스 뿌리기
  - 치즈 뿌리기
  - 오븐에 넣기
  - 10분 기다리기
  - 서빙

## 좋은 경험을 통해 타임랑니에 대해 배운 것

### 협력하는 로봇에 대한 회고

- 타임 라인 커팅으로 서로 다른 작업들을 쉽게 이해할 수 있습니다
- 타임라인 다이어그램을 사용하면 시간에 따라 진행하는 작어을 쉽게 이해할 수 있습니다
- 타임라인 다이어그램은 유연합니다

## 결론

- 계층화 설계
- 타임라인 다이어 그램

## 요점 정리

- 액션과 계산, 데이터를 구분하는 일은 함수형 프로그래머에게 가장 중요하고 첫 번째로 해야하는 일입니다
  - 우리도 코드를 이런 식으로 구분하는 법을 배워야 합니다
  - 3장에서 액션과 계산, 데이터에 대해 다루면서 구분하는 방법을 배워봅시다
- 함수형 프로그래머는 유지보수를 잘 하기 위해 계층형 설계를 사용합니다
  - 각 계층은 코드의 변경 가능성에 따라 나눕니다
  - 계층형 설계 -> 8장, 9장
- 타임라인 다이어그램은 시간에 따라 변하는 액션을 시각과 하는 방법입니다
  - 타임라인 다이어그램으로 액션이 다른 액션과 어떻게 연결되는지 볼 수 있습니다
  - 타임라인 다이어그램 -> 15장
- 액션간 협력을 위해 타임라인 커팅이라는 기술을 살펴봤습니다
  - 타임라인 커팅은 액션이 올바른 순서로 실행할 수 있도록 보장해 줍니다
  - 17장에서 타임라인 커팅을 다룹니다

## 다음장에서 배울 내용

- 액션, 계산, 데이터를 구분하는 함수형사고의 핵심으로 넘어가 보겠습니다
