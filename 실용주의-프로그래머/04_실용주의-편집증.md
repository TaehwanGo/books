# 4. 실용주의 편집증

> 실용주의 프로그래머 Tip 30. 완벽한 소프트웨어는 만들 수 없다

- 우리는 방어적으로 운전한다

  - 문제가 생기기 전에 주의를 하고, 일어나지 않을 법한 일을 기대하며,
    (사실 우리 자신과 큰 차이가 없는) 남의 입장에서 생각해보지 않는다

- 코딩과 유사성

  - 늘 다른 사람의 (우리의 높은 기준에는 못 미칠지도 모르는) 코드와 접촉하고, 적절하거나 혹은 그렇지 못한 입력을 처리하고 있다

- 우리는 방어적으로 코딩하도록 가르침 받았다

  - 만약 조금이라도 의심이 들면, 주어진 모든 정보를 확인한다
  - 잘못된 데이터를 찾아내기 위해 단정문(assertion)을 사용한다
  - 일관성을 확인하고 데이터 베이스 컬럼에 제약을 걸면서 대부분은 스스로 만족해한다

- 하지만 실용주의 프로그래머들은 여기서 한 걸으 더 나아간다
  - `그들은 자기 자신 역시 믿지 않는다`
  - 자기 자신도 완벽한 코드를 작성할 수 없음을 알기에 자신의 실수에 대비해 방어적으로 코드를 짠다

## 개요

- 계약에 의한 설계
  - 첫 번째 방어법
  - 클라이언트와 공급자는 권리와 책임에 대해 동의해야 한다
- 죽은 프로그램은 거짓말을 하지 않는다
  - 버그를 제거하는 중에 어떤 손상도 입히지 않도록 확실히 해야 한다고 말한다
  - 이것 저것 자주 확인하고, 뭔가 일이 틀어질 때 프로그램을 종료
- 단정적 프로그래밍
  - 이런 확인을 쉽게 하는 방법을 소개한다
  - 여러분의 가정을 적극적으로 검증하는 코드를 작성한다
- 언제 예외를 사용할까
  - 예외라는 것은 다른 기법과 마찬가지로 적절히 사용하지 못하면 득보다 실이 더 많다
- 리소스 사용의 균형

  - 프로그램이 다이내믹해지면 메모리, 파일, 디바이스 같은 시스템 자원 여럿을 갖고 곡예를 하게 된다
  - 곡예 중 공을 하나도 떨어뜨리지 않는 방법을 제안한다

- 불완전한 시스템, 어림도 없는 기간, 우스꽝스러운 도구, 불가능한 요구사항으로 가득 찬 세상에서 안전하게 살아보자

## 21. 계약에 의한 설계

- 사람들 사이의 문제를 해결하는 데 얻은 해법을 소프트웨어를 만드는 데에도 적용할 수 있다
- 정직한 거래를 보장하는 최선의 해법 중 하나는 계약이다
- 계약은 양측 모두 자신의 권리와 책임을 정의한다
  - 뿐만 아니라 한쪽이 계약을 어겼을 경우의 손해에 대해서도 계약 사항에 포함된다

### DBC(Design by Contract)

- 계약에 의한 설계
- 프로그램의 정확성을 보장하기 위해 소프트웨어 모듈의 권리와 책임을 문서화(및 이에 대해 동의)하는 데에 초점을 맞춘다
- DBC의 개념을 만든 사람인 마이어는 다음과 같이 주장한다
  - 선행조건(precondition)
  - 후행조건(postcondition)
  - 클래스 불변식(class invariant)

> Tip 31. 계약에 따른 설계를 하라

### DBC 구현

- 언어 지원

  - 자바의 경우 iContract
  - https://www.infoworld.com/article/2074956/icontract-design-by-contract-in-java.html

- 내 생각
  - 타입스크립트의 경우, 함수의 입력 파라미터 타입과 리턴 타입을 명시하면서, 함수의 선행조건과 후행조건을 명시할 수 있을 것 같다

### DBC와 일찍 멈추기

### 불변식의 다른 용도

## 22. 죽은 프로그램은 거짓말을 하지 않는다

- 때때로, 자기 스스로 문제를 인식하기 전에 다른 사람이 먼저 여러분에게 뭐가 문제가 있는지 알아채는 일이 있다
- 다른 사람의 코드도 마찬가지다
- 프로그램에서 뭔가가 잘못되기 시작하면 그걸 먼저 잡아내는 것은 라이브러리 루틴인 경우가 종종 있다

- 모든 에러는 정보를 준다
- 여러분은 에러가 발생할리 없다고 스스로를 설득하고 무시할 수 있다
- 반면에 실용주의 프로그래머는 만약 에러가 있다면 정말로 뭔가 나쁜 일이 생긴 것이라고 자신에게 이야기한다

### 망치지 말고 멈추라

> Tip 32. 일찍 작동을 멈추게 하라

## 23. 단정적 프로그래밍

> Tip 33. 단정문을 사용해서 불가능한 상황을 예방하라

- 절대 일어나지 않을 거란 생각이 든다면 그걸 확인하는 코드를 추가하라
- 이걸 하는 가장 간단한 방법은 단정문(assertion)을 사용하는 것이다

## 24. 언제 예외를 사용할까

### 무엇이 예외적인가

- 잡히지 않은 예외는 프로그램을 종료시킬 것이라고 가정
  - '모든 예외 처리기를 제거해도 이 코드가 여전히 실행될까'라고 자문해보자
    - 만약 그 답이 '아니오'라면 아마도 예외가 비예외적인 상황에서 사용되고 있는 것이다

> 예외는 예외적인 문제에 사용하라

## 25. 리소스 사용의 균형

> Tip 35. 시작한 것은 끝내라

### 중첩 할당

- 1. 리소스를 할당한 순서의 반대로 해제하라
  - 이렇게 해야 한 리소스가 다른 리소스를 참조하는 경우에도 리소스를 고아로 만들지 않는다
- 2. 코드의 여러 곳에서 동일한 리소스 집합을 할당하는 경우, 할당 순서를 언제나 같게 하라
  - 교착 가능성이 줄어들 것이다

### 객체와 예외

### 균형과 예외
